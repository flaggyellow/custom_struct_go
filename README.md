# custom_struct_go
custom structure for private use

这个库用于存放一些自己造的奇葩轮子，用于解决一些工作生活中遇到的需求。

### lockfree skiplist

这是一个使用byte数组作为key的无锁并发跳表，适用于需要按字典序对 字符串/byte数组 进行维护的场景。

虽然删除操作也可以是无锁并发的，但是这个跳表的使用场景几乎不需要删除（写时不会删，删时不会写），所以就做成非并发的接口了，需要上层加锁来保证正确性，这样可以加速其他操作，以及避免aba问题，大幅降低实现复杂度。

经测试，byte数组的compare比string的compare快，所以还是以byte数组作为key。

除了byte数组compare外，另一大性能瓶颈是store和load原子操作，未来希望能尽可能减少它们的使用。

### lockfree semaphore

一个特殊的同步信号量，专门为多消费者单生产者而设计，且消费者的个数是提前确定好的。主要需要解决的问题是防止消费者过度竞争锁，导致生产者放不进资源，从而影响性能。

* 具备水位线机制，初始可预先投放一定资源，当信号量没有余量时，消费者阻塞，当信号量余量超过水位线再唤醒消费者。

* 使用FAA和CAS解决锁竞争问题，尽量不使用锁。

本信号量的使用场景保证了消费者会先消费，然后生产者再投放资源，生产者能投放的资源等于消费者消费掉的资源，所以在现有实现下，虽然在目标场景中用着没问题，但是可以想见它不具备泛用性，会存在各种各样的问题。目前能想到的问题有：

* 如果资源满了生产者还往里放会直接panic；

-------

### TODOLIST

* 暂无
